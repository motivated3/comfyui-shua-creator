import{b as He,r as n,j as e,e as Y,q as le,d as ce,x as Ke,k as w,p as z,m as ve,aw as de,f as $e,i as qe,o as Ge,G as Xe,h as Ye,ax as ue,B as ne,an as Ze,ao as Je,ap as Qe,aq as et,ar as tt,as as st,at as nt,av as at}from"./input.js";import{u as ot,c as P,M as oe,a as he,I as Z,b as it,d as ie,e as W,B as X,f as Fe,g as Se,H as U,h as De,t as rt,R as K,F as lt,i as ct,j as dt,k as H,l as ut,w as T,m as ht,n as pt,o as Me,p as ft,q as mt,E as gt,S as ke,T as ae,r as G,s as Ee,v as xt,x as vt,y as kt,z as yt,A as jt,C as Le,D as Ct,G as wt,J as Q,K as bt,W as Pe,L as It,N as Re,O as Ft,P as St,Q as Dt,U as Mt,V as Et,X as ye,Y as Lt}from"./App-M2h1406m.js";import{app as se}from"/scripts/app.js";import{t as Pt}from"./index-pz0vT7Or.js";import"/scripts/api.js";var[js,Rt]=He({name:"CheckboxGroupContext",strict:!1});function At(o){const[t,a]=n.useState(o),[i,r]=n.useState(!1);return o!==t&&(r(!0),a(o)),i}function Tt(o){return e.jsx(Y.svg,{width:"1.2em",viewBox:"0 0 12 10",style:{fill:"none",strokeWidth:2,stroke:"currentColor",strokeDasharray:16},...o,children:e.jsx("polyline",{points:"1.5 6 4.5 9 10.5 1"})})}function zt(o){return e.jsx(Y.svg,{width:"1.2em",viewBox:"0 0 24 24",style:{stroke:"currentColor",strokeWidth:4},...o,children:e.jsx("line",{x1:"21",x2:"3",y1:"12",y2:"12"})})}function Ot(o){const{isIndeterminate:t,isChecked:a,...i}=o,r=t?zt:Tt;return a||t?e.jsx(Y.div,{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx(r,{...i})}):null}var _t={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function Nt(o,t=[]){const a=Object.assign({},o);for(const i of t)i in a&&delete a[i];return a}function Wt(o={}){const t=ot(o),{isDisabled:a,isReadOnly:i,isRequired:r,isInvalid:l,id:u,onBlur:h,onFocus:y,"aria-describedby":g}=t,{defaultChecked:c,isChecked:p,isFocusable:f,onChange:s,isIndeterminate:d,name:v,value:C,tabIndex:k=void 0,"aria-label":F,"aria-labelledby":b,"aria-invalid":m,...E}=o,R=Nt(E,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),O=le(s),B=le(h),$=le(y),[V,J]=n.useState(!1),[_,q]=n.useState(!1),[j,S]=n.useState(!1),[D,I]=n.useState(!1);n.useEffect(()=>Pt(J),[]);const L=n.useRef(null),[pe,Oe]=n.useState(!0),[_e,ee]=n.useState(!!c),re=p!==void 0,M=re?p:_e,fe=n.useCallback(x=>{if(i||a){x.preventDefault();return}re||ee(M?x.target.checked:d?!0:x.target.checked),O==null||O(x)},[i,a,M,re,d,O]);ce(()=>{L.current&&(L.current.indeterminate=!!d)},[d]),Ke(()=>{a&&q(!1)},[a,q]),ce(()=>{const x=L.current;if(!(x!=null&&x.form))return;const A=()=>{ee(!!c)};return x.form.addEventListener("reset",A),()=>{var N;return(N=x.form)==null?void 0:N.removeEventListener("reset",A)}},[]);const me=a&&!f,ge=n.useCallback(x=>{x.key===" "&&I(!0)},[I]),xe=n.useCallback(x=>{x.key===" "&&I(!1)},[I]);ce(()=>{if(!L.current)return;L.current.checked!==M&&ee(L.current.checked)},[L.current]);const Ne=n.useCallback((x={},A=null)=>{const N=te=>{_&&te.preventDefault(),I(!0)};return{...x,ref:A,"data-active":w(D),"data-hover":w(j),"data-checked":w(M),"data-focus":w(_),"data-focus-visible":w(_&&V),"data-indeterminate":w(d),"data-disabled":w(a),"data-invalid":w(l),"data-readonly":w(i),"aria-hidden":!0,onMouseDown:z(x.onMouseDown,N),onMouseUp:z(x.onMouseUp,()=>I(!1)),onMouseEnter:z(x.onMouseEnter,()=>S(!0)),onMouseLeave:z(x.onMouseLeave,()=>S(!1))}},[D,M,a,_,V,j,d,l,i]),We=n.useCallback((x={},A=null)=>({...x,ref:A,"data-active":w(D),"data-hover":w(j),"data-checked":w(M),"data-focus":w(_),"data-focus-visible":w(_&&V),"data-indeterminate":w(d),"data-disabled":w(a),"data-invalid":w(l),"data-readonly":w(i)}),[D,M,a,_,V,j,d,l,i]),Be=n.useCallback((x={},A=null)=>({...R,...x,ref:ve(A,N=>{N&&Oe(N.tagName==="LABEL")}),onClick:z(x.onClick,()=>{var N;pe||((N=L.current)==null||N.click(),requestAnimationFrame(()=>{var te;(te=L.current)==null||te.focus({preventScroll:!0})}))}),"data-disabled":w(a),"data-checked":w(M),"data-invalid":w(l)}),[R,a,M,l,pe]),Ve=n.useCallback((x={},A=null)=>({...x,ref:ve(L,A),type:"checkbox",name:v,value:C,id:u,tabIndex:k,onChange:z(x.onChange,fe),onBlur:z(x.onBlur,B,()=>q(!1)),onFocus:z(x.onFocus,$,()=>q(!0)),onKeyDown:z(x.onKeyDown,ge),onKeyUp:z(x.onKeyUp,xe),required:r,checked:M,disabled:me,readOnly:i,"aria-label":F,"aria-labelledby":b,"aria-invalid":m?!!m:l,"aria-describedby":g,"aria-disabled":a,style:_t}),[v,C,u,fe,B,$,ge,xe,r,M,me,i,F,b,m,l,g,a,k]),Ue=n.useCallback((x={},A=null)=>({...x,ref:A,onMouseDown:z(x.onMouseDown,Bt),"data-disabled":w(a),"data-checked":w(M),"data-invalid":w(l)}),[M,a,l]);return{state:{isInvalid:l,isFocused:_,isChecked:M,isActive:D,isHovered:j,isIndeterminate:d,isDisabled:a,isReadOnly:i,isRequired:r},getRootProps:Be,getCheckboxProps:Ne,getIndicatorProps:We,getInputProps:Ve,getLabelProps:Ue,htmlProps:R}}function Bt(o){o.preventDefault(),o.stopPropagation()}var Vt={display:"inline-flex",alignItems:"center",justifyContent:"center",verticalAlign:"top",userSelect:"none",flexShrink:0},Ut={cursor:"pointer",display:"inline-flex",alignItems:"center",verticalAlign:"top",position:"relative"},Ht=de({from:{opacity:0,strokeDashoffset:16,transform:"scale(0.95)"},to:{opacity:1,strokeDashoffset:0,transform:"scale(1)"}}),Kt=de({from:{opacity:0},to:{opacity:1}}),$t=de({from:{transform:"scaleX(0.65)"},to:{transform:"scaleX(1)"}}),Ae=$e(function(t,a){const i=Rt(),r={...i,...t},l=qe("Checkbox",r),u=Ge(t),{spacing:h="0.5rem",className:y,children:g,iconColor:c,iconSize:p,icon:f=e.jsx(Ot,{}),isChecked:s,isDisabled:d=i==null?void 0:i.isDisabled,onChange:v,inputProps:C,...k}=u;let F=s;i!=null&&i.value&&u.value&&(F=i.value.includes(u.value));let b=v;i!=null&&i.onChange&&u.value&&(b=Xe(i.onChange,v));const{state:m,getInputProps:E,getCheckboxProps:R,getLabelProps:O,getRootProps:B}=Wt({...k,isDisabled:d,isChecked:F,onChange:b}),$=At(m.isChecked),V=n.useMemo(()=>({animation:$?m.isIndeterminate?`${Kt} 20ms linear, ${$t} 200ms linear`:`${Ht} 200ms linear`:void 0,fontSize:p,color:c,...l.icon}),[c,p,$,m.isIndeterminate,l.icon]),J=n.cloneElement(f,{__css:V,isIndeterminate:m.isIndeterminate,isChecked:m.isChecked});return e.jsxs(Y.label,{__css:{...Ut,...l.container},className:Ye("chakra-checkbox",y),...B(),children:[e.jsx("input",{className:"chakra-checkbox__input",...E(C,a)}),e.jsx(Y.span,{__css:{...Vt,...l.control},className:"chakra-checkbox__control",...R(),children:J}),g&&e.jsx(Y.span,{className:"chakra-checkbox__label",...O(),__css:{marginStart:h,...l.label},children:g})]})});Ae.displayName="Checkbox";var qt=P("chevron-right","IconChevronRight",[["path",{d:"M9 6l6 6l-6 6",key:"svg-0"}]]),Gt=P("chevron-up","IconChevronUp",[["path",{d:"M6 15l6 -6l6 6",key:"svg-0"}]]),Xt=P("dots-vertical","IconDotsVertical",[["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M12 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]),je=P("file-import","IconFileImport",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M5 13v-8a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2h-5.5m-9.5 -2h7m-3 -3l3 3l-3 3",key:"svg-1"}]]),Yt=P("file","IconFile",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}]]),Zt=P("folder-plus","IconFolderPlus",[["path",{d:"M12 19h-7a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v3.5",key:"svg-0"}],["path",{d:"M16 19h6",key:"svg-1"}],["path",{d:"M19 16v6",key:"svg-2"}]]),Jt=P("folder","IconFolder",[["path",{d:"M5 4h4l3 3h7a2 2 0 0 1 2 2v8a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2",key:"svg-0"}]]),Qt=P("lock-open","IconLockOpen",[["path",{d:"M5 11m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M12 16m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M8 11v-5a4 4 0 0 1 8 0",key:"svg-2"}]]),Te=P("lock","IconLock",[["path",{d:"M5 13a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-6z",key:"svg-0"}],["path",{d:"M11 16a1 1 0 1 0 2 0a1 1 0 0 0 -2 0",key:"svg-1"}],["path",{d:"M8 11v-4a4 4 0 1 1 8 0v4",key:"svg-2"}]]),es=P("moon","IconMoon",[["path",{d:"M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z",key:"svg-0"}]]),ts=P("pencil","IconPencil",[["path",{d:"M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4",key:"svg-0"}],["path",{d:"M13.5 6.5l4 4",key:"svg-1"}]]),ss=P("search","IconSearch",[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]]),ns=P("sun","IconSun",[["path",{d:"M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0",key:"svg-0"}],["path",{d:"M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7",key:"svg-1"}]]);const Ce=16;function as({}){const{colorMode:o,toggleColorMode:t}=ue();return e.jsx(e.Fragment,{children:e.jsxs(oe,{isLazy:!0,children:[e.jsx(he,{as:Z,"aria-label":"Options",icon:e.jsx(it,{}),size:"sm",variant:"outline"}),e.jsx(ie,{children:e.jsxs(W,{onClick:t,icon:o==="light"?e.jsx(es,{size:Ce}):e.jsx(ns,{size:Ce}),fontSize:16,children:[o==="light"?"Dark":"Light"," Mode"]})})]})})}const os=(o,t)=>{const[a,i]=n.useState(o);return n.useEffect(()=>{const r=setTimeout(()=>{i(o)},t);return()=>{clearTimeout(r)}},[o,t]),a},is={position:"absolute",marginLeft:"10px",width:"20px",height:"20px",top:"50%",color:"#A0AEC0",transform:"translateY(-50%)"};function rs(o){const{searchValue:t,onUpdateSearchValue:a,style:i}=o,r=t!=="";return e.jsxs(X,{style:{position:"relative",...i},mb:2,children:[e.jsx(ss,{style:is}),r&&e.jsx(Z,{size:"xs",position:"absolute",right:"5px",top:"50%",transform:"translateY(-50%)",cursor:"pointer",background:"none",zIndex:"100",icon:e.jsx(Fe,{width:15,height:15}),onClick:()=>a(""),"aria-label":"clear input button"}),e.jsx(Se,{placeholder:o.placeholder??"Search",size:"sm",paddingLeft:"35px",paddingBlock:"5px",value:t,onChange:({target:l})=>a(l.value)})]})}const we=6;function ls({setSelectedTag:o,selectedTag:t}){const[a,i]=n.useState(!1),[r,l]=n.useState([]);return n.useEffect(()=>{var u;(u=rt)==null||u.listAll().then(h=>{l(h)})},[]),e.jsxs(U,{spacing:2,wrap:"wrap",mb:0,children:[t!=null&&e.jsx(Z,{"aria-label":"Close",size:"sm",icon:e.jsx(Fe,{}),onClick:()=>{o(void 0)}}),r.slice(0,a?void 0:we).map(u=>e.jsx(ne,{variant:"solid",width:"auto",flexShrink:0,size:"sm",borderRadius:15,py:4,onClick:()=>{o(u.name)},isActive:t===u.name,children:u.name},u.name)),(r.length??0)>we&&e.jsx(Z,{"aria-label":"Show-all-tags",size:"sm",icon:a?e.jsx(Gt,{}):e.jsx(De,{}),onClick:()=>i(!a)})]})}function cs({folder:o,onclose:t}){const[a,i]=n.useState(o.name),[r,l]=n.useState(""),{onRefreshFilesList:u}=n.useContext(K),h=g=>{i(g.target.value),r&&l("")},y=async()=>{var p,f;const g=a.trim();if(i(g),g===o.name)return t();await((p=H)==null?void 0:p.generateUniqueName(g,o.parentFolderID??""))!==g?l("The name is duplicated, please modify it and submit again."):(await((f=H)==null?void 0:f.update(o.id,{name:g})),u&&u(),t())};return e.jsxs(Ze,{isOpen:!0,onClose:t,children:[e.jsx(Je,{}),e.jsxs(Qe,{children:[e.jsx(et,{children:"Edit folder name"}),e.jsx(tt,{}),e.jsx(st,{children:e.jsxs(lt,{isInvalid:!!r,children:[e.jsx(ct,{children:"Folder name"}),e.jsx(Se,{value:a,onChange:h,autoFocus:!0,onKeyUp:g=>{g.code==="Enter"&&!r&&a&&y()}}),r&&e.jsx(dt,{children:r})]})}),e.jsxs(nt,{children:[e.jsx(ne,{colorScheme:"teal",mr:3,onClick:y,isDisabled:!a||!!r,children:"Save"}),e.jsx(ne,{onClick:t,children:"Cancel"})]})]})]})}function ds({parentFolderID:o,onlyImportFile:t=!1}){const{onRefreshFilesList:a}=n.useContext(K),[i,r]=n.useState("file"),l=n.useRef(null),u=c=>{var p;r(c),c==="folder"?l.current.setAttribute("webkitdirectory",""):l.current.removeAttribute("webkitdirectory"),(p=l.current)==null||p.click()},h=async c=>{var p;if(c.type==="image/png"){const f=await ht(c),s=f==null?void 0:f.workflow;if(s)return{json:s,name:c.name.replace(".png","")}}else if(c.type==="application/json"||(p=c.name)!=null&&p.endsWith(".json"))return await new Promise((f,s)=>{const d=new FileReader;d.onload=v=>{var C;try{const k=(C=v.target)==null?void 0:C.result;typeof k=="string"?f({json:k,name:c.name.replace(".json","")}):s(new Error("File content is not a string"))}catch(k){s(k)}},d.onerror=s,d.readAsText(c)});return null},y=async c=>{var f,s;const p=[c];for(;p.length>0;){const d=p.shift();if(d&&!d.isFile){const v=await((f=H)==null?void 0:f.create({name:d.name,parentFolderID:d.parentFolderID}));if(d.children&&d.children.length){const C=[];d.children.forEach(k=>{k.isFile&&k.file?C.push(k.file):(k.parentFolderID=v==null?void 0:v.id,p.push(k))}),C.length&&await((s=T)==null?void 0:s.batchCreateFlows(C,void 0,v==null?void 0:v.id))}}}a==null||a()},g=async c=>{var f;const p=c.target.files;if(p)if(i==="folder"){const s={name:p[0].webkitRelativePath.split("/")[0],isFile:!1,children:[]};for(const d of p)if(d.name!==".DS_Store"){const v=d.webkitRelativePath.split("/");let C=s.children??[];for(let k=1;k<v.length;k++){const F=v[k];let b=C.find(m=>m.name===F);if(!b){if(b={name:F,isFile:k===v.length-1,children:k===v.length-1?void 0:[]},b.isFile){const m=await h(d);m&&(b.file=m)}C.push(b)}b&&!b.isFile&&(C=b.children)}}y(s)}else{const s=[];for(const d of p){const v=await h(d);v&&s.push(v)}s.length&&(await((f=T)==null?void 0:f.batchCreateFlows(s,void 0,o)),a&&a())}};return e.jsxs(e.Fragment,{children:[t?e.jsx(W,{onClick:c=>{c.stopPropagation(),u("file")},icon:e.jsx(je,{size:19}),children:"Import workflows"}):e.jsxs(oe,{closeOnSelect:!0,children:[e.jsx(he,{as:ne,leftIcon:e.jsx(je,{size:18}),variant:"outline",iconSpacing:1,size:"sm",colorScheme:"teal",children:"Import"}),e.jsx(ie,{children:ut.map((c,p)=>e.jsx(W,{onClick:()=>{u(c.type)},iconSpacing:2,icon:c.type==="folder"?e.jsx(Jt,{size:18}):e.jsx(Yt,{size:18}),children:c.title},p))})]}),e.jsx("input",{style:{display:"none"},ref:l,type:"file",accept:".json,image/png",multiple:!0,onChange:g,onClick:c=>{c.stopPropagation()}})]})}function us({menuPosition:o,isopen:t,folder:a,onClose:i}){const[r,l]=n.useState(!1),{onRefreshFilesList:u}=n.useContext(K),{showDialog:h}=at(),y=async f=>{var s;f.stopPropagation(),await((s=H)==null?void 0:s.create({name:"New Folder",parentFolderID:a.id})),u&&u()},g=async f=>{var s;f.stopPropagation(),await((s=T)==null?void 0:s.createFlow({json:JSON.stringify(ft),parentFolderID:a.id})),u&&u()},c=async f=>{f.stopPropagation();const s=await mt(a.id);h(`Do you want to delete the ${s} files inside the folder too?`,[{label:"Delete all files",colorScheme:"red",onClick:()=>{p(gt.DELETE)}}])},p=async f=>{var s;await((s=H)==null?void 0:s.deleteFolder(a.id,f)),i(),u&&u()};return e.jsxs(e.Fragment,{children:[e.jsx(X,{position:"absolute",top:o.y,left:o.x,children:e.jsx(oe,{isOpen:t,onClose:i,isLazy:!0,lazyBehavior:"keepMounted",children:e.jsxs(ie,{children:[e.jsx(W,{icon:e.jsx(ts,{size:19}),onClick:f=>{f.preventDefault(),f.stopPropagation(),l(!0)},children:"Rename"}),e.jsx(W,{icon:e.jsx(pt,{size:19}),onClick:c,children:"Delete"}),e.jsx(W,{onClick:y,icon:e.jsx(Zt,{size:19}),children:"New folder"}),e.jsx(W,{onClick:g,icon:e.jsx(Me,{size:19}),children:"New file"}),e.jsx(ds,{parentFolderID:a.id,onlyImportFile:!0})]})})}),r&&e.jsx(cs,{folder:a,onclose:()=>l(!1)})]})}const be=n.memo(function({folder:t}){const[a,i]=n.useState(!1),[r,l]=n.useState(t.isCollapse??!0),[u,h]=n.useState([]),[y,g]=n.useState({x:0,y:0}),[c,p]=n.useState(!1),{colorMode:f}=ue(),{draggingFile:s,setDraggingFile:d,refreshFolderStamp:v,onRefreshFilesList:C}=n.useContext(K),k=f==="light"?{backgroundColor:"#E2E8F0"}:{backgroundColor:"#4A5568"};n.useEffect(()=>{var m;r||(m=T)==null||m.listFolderContent(t.id,window.localStorage.getItem(Ee)).then(E=>{h(E)})},[t.id,v,r]);const F=m=>{m.preventDefault(),g({x:m.clientX,y:m.clientY}),p(!0)},b=async m=>{var E,R;if(m.preventDefault(),m.stopPropagation(),!s)return i(!1);if(G(s)){if(s.id===t.id)return i(!1);await((E=H)==null?void 0:E.update(s.id,{parentFolderID:t.id}))}else G(s)||await((R=T)==null?void 0:R.updateFolder(s.id,{parentFolderID:t.id}));await(C==null?void 0:C()),i(!1)};return n.useEffect(()=>{var m;!!t.isCollapse!==r&&((m=H)==null||m.update(t.id,{isCollapse:r}))},[r]),n.useEffect(()=>{var B;const m=(B=T)==null?void 0:B.curWorkflow,E=(m==null?void 0:m.parentFolderID)+"/",R=t.id+"/";E.startsWith(R)&&l(!1)},[]),e.jsxs(ke,{children:[e.jsxs(U,{w:"100%",as:"button",py:1,onClick:()=>{l(!r)},onContextMenu:F,draggable:"true",onDragOver:m=>{m.preventDefault(),m.stopPropagation(),i(!0)},onDragLeave:m=>{m.preventDefault(),m.stopPropagation(),i(!1)},onDragStart:()=>d==null?void 0:d(t),onDrop:b,_hover:k,style:a||c?k:void 0,className:"droppable",children:[e.jsxs(U,{gap:1,children:[r?e.jsx(qt,{size:20}):e.jsx(De,{size:20}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"#EFC54D",style:{width:"1.2rem",height:"1.2rem"},children:e.jsx("path",{d:"M19.5 21a3 3 0 0 0 3-3v-4.5a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3V18a3 3 0 0 0 3 3h15ZM1.5 10.146V6a3 3 0 0 1 3-3h5.379a2.25 2.25 0 0 1 1.59.659l2.122 2.121c.14.141.331.22.53.22H19.5a3 3 0 0 1 3 3v1.146A4.483 4.483 0 0 0 19.5 9h-15a4.483 4.483 0 0 0-3 1.146Z"})})]}),e.jsx(ae,{children:t.name})]}),e.jsx(us,{isopen:c,menuPosition:y,onClose:()=>p(!1),folder:t}),!r&&e.jsx(ke,{ml:4,gap:0,children:e.jsx(ze,{items:u})})]})});function hs({mediaLocalPath:o,size:t,isPreview:a,autoPlay:i,hideBrokenImage:r,objectFit:l,onBrokenLink:u}){const[h,y]=n.useState(!0);return n.useEffect(()=>{r&&(async()=>{try{if((await fetch(a?`/workspace/preview_media?filename=${o}`:`/workspace/view_media?filename=${o}`)).status==404){y(!1),u==null||u();return}}catch(c){console.error("Error checking media exists",c)}})()},[]),h?xt(o)?e.jsx(vt,{borderRadius:3,boxSize:`${t}px`,objectFit:l??"cover",src:`/workspace/view_media?filename=${o}`,alt:"workflow image renamed or moved from output folder"}):e.jsx("div",{style:{width:t+"px",height:t+"px",overflow:"hidden",position:"relative"},children:e.jsx("video",{width:t,height:t,src:`/workspace/view_media?filename=${o}`,loop:!0,autoPlay:i??!1,muted:!0,style:{objectFit:"cover",width:"100%",height:"100%"},children:e.jsx("track",{kind:"captions"})})}):null}function ps({workflow:o}){const t=n.useRef(null),a=kt(),[i,r]=n.useState(o.saveLock??!1),l=async()=>{var y;const h=!i;r(h),await((y=T)==null?void 0:y.updateMetaInfo(o.id,{saveLock:h})),a({title:`${h?"Locked":"Unlocked"} successfully`,status:"success",duration:2e3})},u=async h=>{const y=h.target.files;if(!y)return;const g=new FormData;Array.from(y).forEach((c,p)=>{g.append(`images[${p}]`,c,c.name)}),g.append("subfolder","inner_enhance"),await fetch("/workspace/images/save",{method:"POST",body:g}),Array.from(y).forEach(async c=>{var f,s;const p=`inner_enhance/${c.name}`;(f=wt)==null||f.create({workflowID:o.id,localPath:p}),(s=T)==null||s.updateMetaInfo(o.id,{coverMediaPath:p})})};return e.jsxs(e.Fragment,{children:[e.jsxs(oe,{isLazy:!0,closeOnSelect:!1,placement:"right",gutter:0,children:[e.jsx(he,{border:0,as:Z,"aria-label":"Options",icon:e.jsx(Xt,{size:20}),size:"sm",variant:"outline"}),e.jsxs(ie,{zIndex:101,children:[e.jsx(W,{icon:e.jsx(yt,{size:20}),onClick:()=>jt(o.id),children:"Open in new tab"}),e.jsx(Le,{hasArrow:!0,label:i?"Unlock workflow, allow modifying":"Lock workflow, prevent modifying",placement:"bottom",children:e.jsx(W,{icon:i?e.jsx(Te,{}):e.jsx(Qt,{}),onClick:l,children:i?"Unlock":"Lock"})}),e.jsx(W,{icon:e.jsx(Ct,{}),onClick:()=>{var h;(h=t.current)==null||h.click()},children:"Upload Thumbnail Image"})]})]}),e.jsx("input",{style:{display:"none"},ref:t,type:"file",accept:".json,image/png",multiple:!0,onChange:u,onClick:h=>{h.stopPropagation()}})]})}function fs({workflow:o}){const{onDeleteFlow:t}=n.useContext(K);return e.jsxs(Q,{justifyContent:"flex-end",children:[e.jsx(bt,{promptMessage:"Are you sure you want to delete this workflow?",onDelete:()=>{t&&t(o.project_id??"")}}),e.jsx(ps,{workflow:o})]})}const Ie=n.memo(function({workflow:t}){var v,C,k,F;const{colorMode:a}=ue(),{setDraggingFile:i,isMultiSelecting:r,onMultiSelectFlow:l,multiSelectedFlowsID:u}=n.useContext(K),h=u&&u.length>0&&u.includes(t.id),{curFlowID:y,loadWorkflowID:g}=n.useContext(Pe),c=y===t.id,p=a==="light"?"gray.200":"#4A5568",[f,s]=n.useState(!1),d=e.jsx(X,{flexShrink:1,flexGrow:1,backgroundColor:c?"teal.200":void 0,color:c&&!r?"#333":void 0,draggable:!r,onDragStart:()=>i==null?void 0:i(t),borderRadius:6,px:1,py:"5px",onClick:()=>{!r&&g(t.id)},_hover:{bg:p},children:e.jsxs(U,{flexGrow:1,children:[!((C=(v=Re)==null?void 0:v.settings)!=null&&C.hideCoverImage)&&(((k=t.coverMediaPath)==null?void 0:k.length)||((F=t.latestImage)==null?void 0:F.length))&&e.jsx(hs,{mediaLocalPath:t.coverMediaPath??t.latestImage??"",size:60,hideBrokenImage:!0,isPreview:!0}),e.jsx(X,{textAlign:"left",gap:0,justifyContent:"space-between",flexGrow:1,children:e.jsxs(Q,{alignItems:"center",children:[e.jsx(ae,{fontWeight:"500",noOfLines:1,wordBreak:"break-all",children:t.name??"untitled"}),t.saveLock&&e.jsx(Te,{size:18,style:{display:"inline-block"}})]})})]})});return e.jsx(U,{w:"100%",justify:"space-between",borderBottom:"1px solid",borderColor:a=="dark"?"gray.700":"gray.200",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:r?e.jsx(Ae,{isChecked:h,spacing:4,onChange:b=>{l&&l(t.id,b.target.checked)},children:d}):e.jsxs(e.Fragment,{children:[d,e.jsx(X,{width:"fit-content",children:f?e.jsx(fs,{workflow:t}):e.jsx(ae,{color:"GrayText",fontSize:"sm",children:It(t.create_time??"",!1,!1,"/")})})]})})});function ze({items:o}){var f;const[t,a]=n.useState(!1),i=o.filter(G),r=o.filter(s=>!G(s)),l=(f=r[0])==null?void 0:f.parentFolderID,[u,h]=n.useState(!1),{onRefreshFilesList:y,draggingFile:g,refreshFolderStamp:c}=n.useContext(K),p=async s=>{var d,v;if(s.preventDefault(),s.stopPropagation(),!g)return h(!1);if(G(g)){if(g.id===l)return h(!1);await((d=H)==null?void 0:d.update(g.id,{parentFolderID:l}))}else await((v=T)==null?void 0:v.updateFolder(g.id,{parentFolderID:l}));await(y==null?void 0:y()),h(!1)};return n.useEffect(()=>{var s;(s=Re)==null||s.getSetting("foldersOnTop").then(d=>{a(d??!1)})},[c]),e.jsxs(e.Fragment,{children:[t&&i.map(s=>e.jsx(be,{folder:s},s.id)),e.jsx(X,{border:u?"2px dashed #718096":"2px dashed transparent",onDragOver:s=>{s.preventDefault(),s.stopPropagation(),h(!0)},onDragLeave:s=>{s.preventDefault(),s.stopPropagation(),h(!1)},onDrop:p,className:"droppable",children:t?r.map(s=>e.jsx(Ie,{workflow:s},s.id)):o.map(s=>G(s)?e.jsx(be,{folder:s},s.id):e.jsx(Ie,{workflow:s},s.id))})]})}function Cs({onClose:o,onClickNewFlow:t}){const[a,i]=n.useState([]),r=n.useRef([]),{loadWorkflowID:l,curFlowID:u}=n.useContext(Pe),[h,y]=n.useState(),[g,c]=n.useState(!1),[p,f]=n.useState([]),[s,d]=n.useState(0),[v,C]=n.useState(""),k=os(v,400),F=n.useRef(null),[b,m]=n.useState(null),E=n.useRef(window.localStorage.getItem(Ee)??Ft.RECENTLY_MODIFIED),R=!!h||!!k.length,O=async()=>{var S;const j=await Et()??[];console.log("curFolderContent",j),i(ye(j,E.current)),d(Date.now()),r.current=await((S=T)==null?void 0:S.listAll())??[],console.log("allFlowsRef.current",r.current)},B=()=>{const j=r.current.filter(S=>{var L;let D=!0,I=!0;return h&&(D=!!((L=S.tags)!=null&&L.includes(h))),k&&(I=!!S.name.toLocaleLowerCase().includes(k.toLocaleLowerCase())),D&&I});i(ye(j,E.current))};n.useEffect(()=>{R?B():O()},[k,h]);const $=n.useCallback(async j=>{var S,D;await St(j),((D=(S=T)==null?void 0:S.curWorkflow)==null?void 0:D.id)===j&&await(l==null?void 0:l(null)),await O()},[h,k]);n.useEffect(()=>{const j=async S=>{var D;if(F.current){const I=await((D=T)==null?void 0:D.get(F.current));I&&I.json&&Lt(I.json,[S.canvasX,S.canvasY])}};return se.canvasEl.addEventListener("drop",j),se.canvasEl.addEventListener("click",o),()=>{se.canvasEl.removeEventListener("drop",j),se.canvasEl.removeEventListener("click",o)}},[]);const V=n.useCallback((j,S)=>{f(D=>{const I=[...D];return S?I.push(j):I.splice(I.indexOf(j),1),I})},[]),J=j=>{m(j),G(j)||(F.current=j.id)},_=j=>{C(j)},q=450;return e.jsx(K.Provider,{value:{onRefreshFilesList:O,draggingFile:b??void 0,setDraggingFile:J,isMultiSelecting:g,onMultiSelectFlow:V,multiSelectedFlowsID:p,onDeleteFlow:$,refreshFolderStamp:s,setRefreshFolderStamp:d},children:e.jsx(X,{style:{width:q},children:e.jsxs(Dt,{width:q,height:"100vh",pl:2,pr:2,pt:4,gap:4,position:"absolute",top:0,left:0,shadow:"xl",zIndex:Mt,children:[e.jsxs(Q,{alignItems:"center",justifyContent:"space-between",children:[e.jsxs(U,{gap:4,children:[e.jsx(U,{gap:2,children:e.jsx(ae,{fontSize:19,fontWeight:600,children:"ðŸ¦„Workspace"})}),e.jsx(Le,{label:"New workflow",children:e.jsx(Z,{"aria-label":"New workflow",size:"sm",icon:e.jsx(Me,{}),variant:"outline",colorScheme:"teal",onClick:t})})]}),e.jsx(U,{alignItems:"center",children:e.jsx(as,{})})]}),e.jsxs(Q,{direction:"column",h:"calc(100% - 64px)",children:[e.jsx(ls,{selectedTag:h,setSelectedTag:y}),e.jsx(rs,{searchValue:v,onUpdateSearchValue:_}),e.jsx(Q,{overflowY:"auto",overflowX:"hidden",direction:"column",style:{overflowY:"scroll",scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx(ze,{items:a})})]})]})})})}export{Cs as default};
